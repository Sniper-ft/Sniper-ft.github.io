# Chapter 1: 引言
## 1.1 安全加法与投票
1. **秘密分享：**它允许秘密的拥有者（例如 P1）向所有参与方“分享”某个秘密 x，使得当所有参与方聚集在一起时可以恢复出 x，但是任何除 P1 以外的单一参与方都不能独自获得关于 x 的任何信息。

## 安全多方计算协议的例子
### 1 *拉格朗日插值法 (Lagrange Interpolation Method)**。

**核心思想：**

拉格朗日插值法是一种多项式插值方法。它的核心思想是，对于平面上给定的 $l+1$ 个横坐标（x值）互不相同的点，我们可以唯一地确定一个次数不超过 $l$ 的多项式，使得这个多项式恰好穿过所有这些给定的点。拉格朗日插值法提供了一种直接构造出这个多项式的方法。

**内容解析：**

1.  **基本设定：**
    * 我们有 $l+1$ 个点，它们的横坐标分别是 $\alpha_1, \alpha_2, \dots, \alpha_{l+1}$。
    * 一个重要的前提条件是：所有这些横坐标 $\alpha_i$ 都互不相同，即对于任意 $i \neq j$，都有 $\alpha_i \neq \alpha_j$。
    * 我们希望找到一个多项式 $q(x)$，它的次数最多是 $l$（即至多 $l$ 次），并且这个多项式要经过所有这些给定的点。

2.  **拉格朗日插值多项式 $q(x)$ 的构造：**
    图片中给出了 $q(x)$ 的表达式：
    $$q(x) = \sum_{i=1}^{l+1} q(\alpha_i) \delta_i(x)$$
    * $q(\alpha_i)$：这是第 $i$ 个给定点的纵坐标（y值）。在实际应用中，这些通常是已知的数据点。
    * $\delta_i(x)$：这被称为**拉格朗日基函数**或**拉格朗日基本多项式**。它是整个构造方法的核心。

3.  **拉格朗日基函数 $\delta_i(x)$：**
    * **定义：** 对于每一个 $i$ (从 1 到 $l+1$)，都有一个对应的基函数 $\delta_i(x)$。这个基函数本身也是一个 $l$ 次多项式。
    * **关键性质：**
        * 当 $x = \alpha_i$ 时（即在第 $i$ 个给定的点的横坐标处），$\delta_i(\alpha_i) = 1$。
        * 当 $x = \alpha_j$ 且 $j \neq i$ 时（即在其他任何一个给定的点的横坐标处），$\delta_i(\alpha_j) = 0$。
    * **表达式：** 图片中给出了 $\delta_i(x)$ 的具体构造方法：
        $$\delta_i(x) = \prod_{1 \le j \le l+1, j \neq i} \frac{x - \alpha_j}{\alpha_i - \alpha_j}$$
        这个公式看起来复杂，但它的含义是：
        * 对于每一个 $\delta_i(x)$，我们构造一个连乘积。
        * 连乘积的每一项都是一个分式。
        * 分式的分子是 $(x - \alpha_j)$，其中 $\alpha_j$ 是**除了** $\alpha_i$ **之外**的其他所有给定点的横坐标。
        * 分式的分母是 $(\alpha_i - \alpha_j)$，即当前基函数对应的横坐标 $\alpha_i$ 与其他横坐标 $\alpha_j$ 的差。

**为什么这个方法有效？**

我们来验证一下构造出来的 $q(x)$ 是否真的经过了所有给定的点 $(\alpha_k, q(\alpha_k))$。
将 $x = \alpha_k$ (任意一个给定的横坐标) 代入 $q(x)$ 的表达式中：
$$q(\alpha_k) = \sum_{i=1}^{l+1} q(\alpha_i) \delta_i(\alpha_k)$$
根据 $\delta_i(x)$ 的性质：
* 如果 $i = k$，那么 $\delta_i(\alpha_k) = \delta_k(\alpha_k) = 1$。
* 如果 $i \neq k$，那么 $\delta_i(\alpha_k) = 0$。

所以，在上面的求和式中，只有当 $i=k$ 的那一项不为零：
$$q(\alpha_k) = q(\alpha_1) \cdot 0 + \dots + q(\alpha_k) \cdot 1 + \dots + q(\alpha_{l+1}) \cdot 0 = q(\alpha_k)$$
这表明，构造出来的多项式 $q(x)$ 在 $x=\alpha_k$ 处的取值确实是 $q(\alpha_k)$，也就是说，这个多项式确实经过了点 $(\alpha_k, q(\alpha_k))$。由于 $k$ 可以是 $1, 2, \dots, l+1$ 中的任意一个，所以这个多项式经过了所有给定的 $l+1$ 个点。（这里1~l+1指的是相对索引，即参与构建的点）

#### 拉格朗日插值法计算例子

**例子设定：**

1.  **参与者与阈值：**
    * 有 5 个参与者 $P_1, \dots, P_5$。
    * 允许的被攻击参与者数量（或多项式次数相关的参数）$t=2$。这意味着至少需要 $t+1 = 3$ 个参与者才能恢复秘密。多项式的次数将是 $t=2$。

2.  **运算域（Field）：**
    * 所有计算都在模 $11$ 的整数域 $Z_{11}$ 中进行。这意味着所有的数字（秘密、系数、份额）都是 $0$ 到 $10$ 之间的整数，运算结果超过 $10$ 或小于 $0$ 时，都要通过加减 $11$ 的倍数使其回到这个范围内。

3.  **秘密和公开点：**
    * 要分享的秘密是 $s=6$。
    * 为每个参与者 $P_i$ 分配的公开横坐标（x值）是 $\alpha_i$。这里 $\vec{\alpha} = (\alpha_1, \alpha_2, \alpha_3, \alpha_4, \alpha_5) = (1, 2, 3, 4, 5)$。

4.  **秘密多项式的构造：**
    * 分发者（Dealer）需要构造一个 $t=2$ 次的多项式 $h(x)$，使得 $h(0) = s$。
    * 多项式形式为 $h(x) = s + b_1 x + b_2 x^2$。
    * 分发者随机选择系数 $b_1, b_2$ 从 $Z_{11}$ 中选取。例子中，选择了 $b_1 = 7$ 和 $b_2 = 1$。
    * 因此，秘密多项式是：
        $h(x) = 6 + 7x + 1x^2 \pmod{11}$ (即 $h(x) = x^2 + 7x + 6 \pmod{11}$)

**份额的计算与分发：**

每个参与者 $P_i$ 得到一个份额 $( \alpha_i, s_i = h(\alpha_i) \pmod{11} )$。
* $s_1 = h(1) = 1^2 + 7(1) + 6 = 1 + 7 + 6 = 14 \equiv 3 \pmod{11}$
* $s_2 = h(2) = 2^2 + 7(2) + 6 = 4 + 14 + 6 = 24 \equiv 2 \pmod{11}$
* $s_3 = h(3) = 3^2 + 7(3) + 6 = 9 + 21 + 6 = 36 \equiv 3 \pmod{11}$
* $s_4 = h(4) = 4^2 + 7(4) + 6 = 16 + 28 + 6 = 50 \equiv 6 \pmod{11}$
* $s_5 = h(5) = 5^2 + 7(5) + 6 = 25 + 35 + 6 = 66 \equiv 0 \pmod{11}$

所以，五个份额的纵坐标（y值）分别是 $3, 2, 3, 6, 0$。

**秘密的重建：**

假设参与者 $P_3, P_4, P_5$ 合作来重建秘密。他们拥有的份额是：
* $P_3: (\alpha_3, s_3) = (3, 3)$
* $P_4: (\alpha_4, s_4) = (4, 6)$
* $P_5: (\alpha_5, s_5) = (5, 0)$

他们需要使用拉格朗日插值法来重建多项式 $h(x)$，然后计算 $h(0)$ 以得到秘密 $s$。
重建的多项式是 $h(x) = s_3 \delta_3(x) + s_4 \delta_4(x) + s_5 \delta_5(x)$，其中 $\delta_i(x)$ 是拉格朗日基函数。

1.  **计算拉格朗日基函数 $\delta_i(x)$ (模 $11$)**
    * **对于 $\delta_3(x)$:** (使用点 $\alpha_3=3, \alpha_4=4, \alpha_5=5$)
        $$\delta_3(x) = \frac{(x-\alpha_4)(x-\alpha_5)}{(\alpha_3-\alpha_4)(\alpha_3-\alpha_5)} = \frac{(x-4)(x-5)}{(3-4)(3-5)} \pmod{11}$$
        分母：$(3-4)(3-5) = (-1)(-2) = 2 \pmod{11}$。
        我们需要计算 $2^{-1} \pmod{11}$（即2的模11乘法逆元）。因为 $2 \times 6 = 12 \equiv 1 \pmod{11}$，所以 $2^{-1} \equiv 6 \pmod{11}$。
        分子：$(x-4)(x-5) = x^2 - 9x + 20 \equiv x^2 + 2x + 9 \pmod{11}$ (因为 $-9 \equiv 2 \pmod{11}$ and $20 \equiv 9 \pmod{11}$)。
        所以，$\delta_3(x) = (x^2 + 2x + 9) \times 6 = 6x^2 + 12x + 54 \equiv 6x^2 + x + 10 \pmod{11}$。

    * **对于 $\delta_4(x)$:** (使用点 $\alpha_3=3, \alpha_4=4, \alpha_5=5$)
        $$\delta_4(x) = \frac{(x-\alpha_3)(x-\alpha_5)}{(\alpha_4-\alpha_3)(\alpha_4-\alpha_5)} = \frac{(x-3)(x-5)}{(4-3)(4-5)} = \frac{x^2 - 8x + 15}{(1)(-1)} = -(x^2 - 8x + 15) \pmod{11}$$
        $\delta_4(x) = -x^2 + 8x - 15 \equiv 10x^2 + 8x + 7 \pmod{11}$ (因为 $-1 \equiv 10 \pmod{11}$ and $-15 \equiv -4 \equiv 7 \pmod{11}$)。

    * **对于 $\delta_5(x)$:** (使用点 $\alpha_3=3, \alpha_4=4, \alpha_5=5$)
        $$\delta_5(x) = \frac{(x-\alpha_3)(x-\alpha_4)}{(\alpha_5-\alpha_3)(\alpha_5-\alpha_4)} = \frac{(x-3)(x-4)}{(5-3)(5-4)} = \frac{x^2 - 7x + 12}{(2)(1)} = \frac{x^2 - 7x + 12}{2} \pmod{11}$$
        分子：$x^2 - 7x + 12 \equiv x^2 + 4x + 1 \pmod{11}$。
        我们知道 $2^{-1} \equiv 6 \pmod{11}$。
        所以，$\delta_5(x) = (x^2 + 4x + 1) \times 6 = 6x^2 + 24x + 6 \equiv 6x^2 + 2x + 6 \pmod{11}$。

2.  **重建多项式 $h(x)$：**
    $h(x) = s_3 \delta_3(x) + s_4 \delta_4(x) + s_5 \delta_5(x)$
    代入 $s_3=3, s_4=6, s_5=0$ 以及上面计算出的 $\delta_i(x)$：
    $h(x) = 3(6x^2 + x + 10) + 6(10x^2 + 8x + 7) + 0(6x^2 + 2x + 6) \pmod{11}$
    $h(x) = (18x^2 + 3x + 30) + (60x^2 + 48x + 42) \pmod{11}$
    在模 $11$ 下化简各项系数：
    $18 \equiv 7$, $3 \equiv 3$, $30 \equiv 8$
    $60 \equiv 5$, $48 \equiv 4$, $42 \equiv 9$
    $h(x) = (7x^2 + 3x + 8) + (5x^2 + 4x + 9) \pmod{11}$
    $h(x) = (7+5)x^2 + (3+4)x + (8+9) \pmod{11}$
    $h(x) = 12x^2 + 7x + 17 \pmod{11}$
    $h(x) = x^2 + 7x + 6 \pmod{11}$ (因为 $12 \equiv 1 \pmod{11}$ and $17 \equiv 6 \pmod{11}$)

3.  **得到秘密：**
    重建得到的多项式是 $h(x) = x^2 + 7x + 6 \pmod{11}$。
    秘密 $s$ 是 $h(0)$，即多项式的常数项。
    $s = h(0) = 6$。

这与原始秘密 $s=6$ 一致，表明秘密被成功重建。

**文档中的另一种表达方式（收集系数）：**

文档中还展示了先将 $h(x) = s_3\delta_3(x) + s_4\delta_4(x) + s_5\delta_5(x)$ 按 $x$ 的幂次整理，然后再代入 $s_3, s_4, s_5$ 的值：
$h(x) = (6s_3 + 10s_4 + 6s_5)x^2 + (s_3 + 8s_4 + 2s_5)x + (10s_3 + 7s_4 + 6s_5)$
代入 $s_3=3, s_4=6, s_5=0$:
* $x^2$ 的系数: $6(3) + 10(6) + 6(0) = 18 + 60 = 78 \equiv 1 \pmod{11}$
* $x$ 的系数: $1(3) + 8(6) + 2(0) = 3 + 48 = 51 \equiv 7 \pmod{11}$
* 常数项 ($s=h(0)$): $10(3) + 7(6) + 6(0) = 30 + 42 = 72 \equiv 6 \pmod{11}$

所以，$h(x) = 1x^2 + 7x + 6 \pmod{11}$，秘密 $s=6$。两种计算方式结果一致。

这个例子清晰地展示了即使只知道部分份额（满足阈值条件），也可以通过拉格朗日插值法完整地恢复出秘密多项式，并进而得到原始秘密。
